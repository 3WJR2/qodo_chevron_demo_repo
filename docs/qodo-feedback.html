<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Qodo PR Feedback Viewer</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/github-dark.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/diff.min.js"></script>
    <script>
      // Ensure hljs is available globally for module scripts
      window.hljs = typeof hljs !== 'undefined' ? hljs : window.hljs;
    </script>
  </head>
  <body>
    <main class="qodo-layout">
      <section class="panel pr-detail" aria-live="polite">
        <div class="filters-wrapper">
          <button id="filtersToggle" class="filters-toggle" aria-label="Toggle filters" aria-expanded="true">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M12.78 6.22a.75.75 0 010 1.06l-4.25 4.25a.75.75 0 01-1.06 0L3.22 7.28a.75.75 0 011.06-1.06L8 9.94l3.72-3.72a.75.75 0 011.06 0z"></path>
            </svg>
          </button>
          <div class="filters top-stack" id="filtersPanel">
            <select id="stateFilter">
              <option value="open">Open</option>
              <option value="closed">Closed</option>
              <option value="all" selected>All</option>
            </select>
            <input id="tokenInput" type="password" placeholder="GH token (optional)" />
          </div>
        </div>
        <div class="pr-panel-wrapper">
          <div class="pr-panel-content">
            <input id="searchInput" type="search" class="pr-panel-search" placeholder="Search title or #" />
            <div id="prList" class="pr-panel" aria-live="polite"></div>
          </div>
          <div class="pr-panel-resize-handle" id="prPanelResizeHandle" aria-label="Resize PR panel"></div>
        </div>
        <button id="prPanelToggle" class="pr-panel-toggle" aria-label="Toggle PR list" aria-expanded="true">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M9.78 12.78a.75.75 0 01-1.06 0L4.47 8.53a.75.75 0 010-1.06l4.25-4.25a.75.75 0 011.06 1.06L6.06 8l3.72 3.72a.75.75 0 010 1.06z"></path>
          </svg>
        </button>
        <div class="pr-detail-content">
          <div class="detail-header">
            <div class="state-pill" id="prState" data-state="idle">Select a PR</div>
            <h2 id="prTitle">No pull request selected</h2>
            <div class="detail-meta" id="prMeta">
              Use the list on the left to load Qodo feedback for a pull request.
            </div>
          </div>
          <div class="tabs-wrapper">
            <div class="tabs" role="tablist">
              <button class="tab active" data-target="feedbackPanel" role="tab" aria-selected="true">
                Qodo feedback
              </button>
              <button class="tab" data-target="diffPanel" role="tab" aria-selected="false">
                Files Changed
              </button>
            </div>
            <div class="tabs-actions" id="prLinks" hidden>
              <a id="prLink" class="button-link" target="_blank" rel="noopener">View on GitHub</a>
            </div>
          </div>
          <div class="tab-panels">
          <div id="feedbackPanel" class="tab-panel active" role="tabpanel">
            <div class="panel subpanel" aria-live="polite">
              <div class="qodo-messages" id="qodoMessages">
                <div class="empty">No messages yet.</div>
              </div>
            </div>
          </div>
          <div id="diffPanel" class="tab-panel" role="tabpanel" aria-hidden="true">
            <div class="files-changed-panel" aria-live="polite">
              <div class="files-changed-header">
                <div class="files-changed-summary">
                  <span id="diffTotals">0 files changed</span>
                  <span class="files-changed-stats" id="filesChangedStats">+0 -0</span>
                </div>
              </div>
              <div class="files-changed-layout">
                <div class="files-changed-sidebar">
                  <input type="search" id="fileFilterInput" class="file-filter-input" placeholder="Filter changed files" />
                  <div class="diff-files" id="diffFiles">
                    <div class="empty">Choose a pull request to load its diff.</div>
                  </div>
                </div>
                <div class="files-changed-content" id="diffViewer">
                  <div class="empty">Pick a file to preview the diff.</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        </div>
      </section>
    </main>


    <script type="module" src="qodo.js"></script>
  </body>
</html>
